<!-- FINAL PROJECT PAGE -->

<!DOCTYPE html>
<!-- Start of html doc -->
<html lang="en">
    <!-- Container for meta data -->
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <!-- Mobile-optimized website: https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag -->
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- JAVASCRIPT -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

        <!-- STYlE:
            Import documentation from Bootstrap; at https://getbootstrap.com/docs/5.3/getting-started/introduction/
            alternative themes at https://bootswatch.com/ -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <!-- Import own CSS style sheet -->
        <link href="../bootstrap.css" rel="stylesheet">
        <link href="../style.css" rel="stylesheet">
        
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
        <!-- Title of page -->
        <title>PS70_Final_Project</title>
    </head>
    
    <body>
        <nav class="navbar navbar-expand-lg bg-body-tertiary bg-dark border-bottom border-body" data-bs-theme="dark">
            <div class="container-fluid">
              <a class="navbar-brand mb-0 h1" href="../index.html">HOME</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <li class="nav-item">
                    <a class="nav-link" href="../about.html">About</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../finalproject/index.html">Final Project</a>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="../assignments.html" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Assignments
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="../01_intro/index.html">01 - Intro</a></li>
                      <li><a class="dropdown-item" href="../02_2Ddesign/index.html">02 - 2D Design & Cutting</a></li>
                      <li><a class="dropdown-item" href="../03_fabrication/index.html">03 - Hand Tools & Fabrication</a></li>
                      <li><a class="dropdown-item" href="../04_microcontroller/index.html">04 - Microcontrollers</a></li>
                      <li><a class="dropdown-item" href="../05_3Ddesign/index.html">05 - 3D Design & Printing</a></li>
                      <li><a class="dropdown-item" href="../06_input/index.html">06 - Electronic Input Devices</a></li>
                      <li><a class="dropdown-item" href="../07_output/index.html">07 - Electronic Output Devices</a></li>
                      <li><a class="dropdown-item" href="../08_CNC/index.html">08 - CNC Miling</a></li>
                      <li><a class="dropdown-item" href="../09_networking/index.html">09 - Radio, WiFi & Bluetooth</a></li>
                      <li><a class="dropdown-item" href="../10_machine/index.html">10 - Machine Building & Effectors</a></li>
                      <li><a class="dropdown-item" href="../11_project_integration/index.html">11 - Project Integration</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../finalproject/index.html">Final Project</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
          <div class="container-fluid text-center">
            <div class="row">
              <div class="col">
                  <h1>WEEK 11: PROJECT INTEGRATION</h1>
                  <h2>Final Project Progress Documentation</h2>
                  <i>Final Project Finished product on <a href="../finalproject/index.html">Final Project Page</a></i>
              </div>
            </div>
        </div>

        <div class="container-fluid text-start">
            <div class="row justify-content-center">
                <div class="col-6">
                    
                </div>
            </div>
        </div>

        <div class="container-fluid text-start">
            <div class="row justify-content-center">
                <div class="col-8">
                  <h2>Making of the Box:</h2>
                  <p>I wanted to make a box that was easy to assemble and also easily taken apart. That means NO GLUE. First, I thought 
                    about including screws and bolts, but then I saw a box made by a fellow student that used joints that looked like 
                    Mortise and Tenon joints and decided to give that a go. Eventually I ended up designing a box that needs <b>zero tools</b> 
                    for assembly. I opted for Mortise and Tenon joints, because when I used finger joints for my box from week 2, I had to 
                    use glue to keep my box together. Also that box felt weak when it was loaded with heavy materials.
                    <br><br>
                    To connect the bottom with the other sides of the box I had all the <i>tenons</i> attached to the bottom plate and 
                    alls the <i>mortises/holes</i> in the other plates. I made this design choide to prevent the bottom from falling when the 
                    box is lifted up. 
                    <br><br>
                    I also needed a piece in the middle that would separate the box into 2 parts. <b>Part I</b> for the plant + 
                    water bottle and 1<b>Part II</b> for the electronics/microcontroller. <b>Part II</b> also has a plateau for the 
                    peristaltic.
                    <br><br>
                    Before I started designing the box in 360, I measured the water bottle, plant cup and peristaltic pump with a caliper. 
                    I also made a rough sketch of how I wanted to connect the different plates/sides of the box.
                    <br>
                    <h4>Brainstorm:</h4>
                    <img src="./brainstorm_measure.jpg" class="img-fluid">
                    <br>
                    <img src="./brainstorm_joints.jpg" class="img-fluid">
                    <br>
                    After that brainstorm, I turned to Fusion 360 to start designing the box in 3D. Instead of making drawins in 2D, 
                    I designed the entire box in 3D and used the projection function to get sketches of the different sides of the box. I 
                    saved these sketches as DXF files and cut them with the lasercutter.
                    <br><br>
                    I wanted my design in Fusion 360 to be quite flexible because I wasn't sure how big my final box was eventually going to be. 
                    I anticipated I may run into issues in my design process and assembly, so I wanted it to be easy to change the dimensions of my box. 
                    For this, I used parameters for the width, length, height, corner_space, finger joint lenght, material thickness, etc.
                    <br><br>
                    In my design it is fairly easy to adjust the number of joints on each sides of the plagues. However, this was not very easy to accomplish. 
                    When I started my first attempt I drew the side with the fingerjoints and extruded that in one go. However, I soon realized this was't going to work 
                    if I wanted to adjust the number of joints. I then switched to extruding a rectangle, then extruding 1 single joint on a side and then used the rectangular 
                    pattern function to extend the feature that created the first joint. I remembered this trick from following tutorials that helped me make the finger joint 
                    box in week 2. This method proved to be much more effective.
                    <br><br>
                    <p></p>
                    <h4>FUSION 360: TODO</h4>
                    <br>
                    When my design was finished I wanted to test if my Mortise and Tenon joints would work. Therefore, I copy pasted my design and 
                    halved the dimensions. I had to do some problem solving because of the middle piece and some joints because it didn't perfectly 
                    translate to a much smaller size. However, after a quick fix I had enough to test my joints and design. I printed 3 sides of this mini test box:
                    bottom, middle and side plates.
                    <img src="./mini_test.jpg" class="img-fluid">
                    <br>
                    Fortunately, this test showed my joints worked. I then decided to cut out my entire box using cartboard. I felt like I needed to see the physical 
                    box before I continued designing the holder for the peristaltic pump and the holes for the wiring. By using cartboard I would be able to easily cut 
                    out a hole for wiring and adjust my design. When I was satisfied I measured the dimensions with a caliper and included it in my 3D design. 
                    Thankfully, the box was easy to assembl and the joints fit really well first try (bless). I didn't have to use any glue and I could feel the box was very sturdy.
                    <br><br>
                    <h4>ASSEMBLY - VESRION 1</h4>
                    <i>Unassembled: outer plates</i>
                    <img src="./unassembled_outer_pieces.jpg" class="img-fluid">
                    <i>Unassembled: ALL pieces</i>
                    <img src="./unassembled_ALL_pieces.jpg" class="img-fluid">
                    <br><br>
                    <b>STEP 1</b><br>
                    Push middle plates into the bottom plate.<br>
                    <img src="./assem_step1.jpg" class="img-fluid">
                    <br><br>
                    <b>STEP 2</b><br>
                    Push plateau (for motor) plate into middle plate.<br>
                    <img src="./assem_step2.jpg" class="img-fluid">
                    <br><br>
                    <b>STEP 3</b><br>
                    Push side plate into bottom plate, middle plate, and plateau plate. First one side, then the other.<br>
                    <img src="./assem_step3.jpg" class="img-fluid">
                    <img src="./assem_step3b.jpg" class="img-fluid">
                    <br><br>
                    <b>STEP 4</b><br>
                    Put the front and back plates into place. (See final product).<br><br>
                    <h4>FINAL PRODUCT - VERSION 1</h4>
                    <i>Frontview</i>
                    <img src="./assembled_empty_2.jpg" class="img-fluid">
                    <i>Sideview</i>
                    <img src="./assembled_empty_side.jpg" class="img-fluid">
                    <br>
                    <b>With pump, plant cup and water bottle:</b>
                    <img src="./assembled_pump.jpg" class="img-fluid">
                    <p></p>
                  </p>
                  <p></p>
                  <p><h4>CODING:</h4>
                  I used the code below to test if my input values and calculated from the sensor and pump were correct/made sense.</p>
                  <pre><code class="language-arduino">
      // SOIL MOISTURE - CALIBRATION
      // TEST THE PUMP - SOIL MOISTURE SENSOR CODE

      class SoilMoist {
        // CLASS MEMBER VARIABLES
        // variables that are initialized at startup
        int SM_pin; //soil moisture sensor pin
        int interval; // interval at which soil moisture values is read

        float desired_wc; // the desired water content by weight (wc_d)

        float b_dry_soil; // soil moisture sensor value from dry soil.
        float soil_max_wc; // the water content of saturated soil, refer to calibration curve. 
        float a_slope; // the slope from the linear fitted line from calibration.
        float speed_pump; // how many mL/s are moved by the pump. (seconds)
        // weight the dry soil (doesn't need to be from calibration)
        int dry_weight;
        
        // variables that maintain current state
        int y_soil_sensor; // value from the soil moisture sensor

        float x_current_wc; // current water content by weight (wc_c). This is x from y = a*x + b (y_soil_sensor = a_slope * x + b_dry_soil).
        float delta_water_vol; // change in water volume, aka how much mL needs to be added/pumped.
        int time_pump; // time pump is on to get desired water content. (in milliseconds)

        unsigned long lastUpdate; // last update (in milliseconds)

        public:
        SoilMoist(int SENSOR, int INT,  float a, float b, int W_d, float soilMAX_wc, float desiredWC, float PUMPspeed){
          SM_pin = SENSOR;
          interval = INT;
          a_slope = a;
          b_dry_soil = b;
          dry_weight = W_d;
          soil_max_wc = soilMAX_wc;
          desired_wc = desiredWC;
          speed_pump = PUMPspeed;
          
          //pinMode(ledPin, OUTPUT); // set LED pin to an OUTPUT
          //pinMode(pumpPin, OUTPUT); // set pump pin to an OUTPUT
          lastUpdate = 0; // start clock at zero
        }

        void Update(){
          // check to see if it's time to read of the soil moisture value
          if(millis() - lastUpdate >= interval){
            lastUpdate = millis();
            y_soil_sensor = analogRead(SM_pin);
            x_current_wc = (analogRead(SM_pin) - b_dry_soil) / a_slope; // x = (y-b)/a where y is value from sensor, a and b are derived from the calibration of the sensor.
            delta_water_vol = (dry_weight/(1 - desired_wc)) - (dry_weight/(1 - x_current_wc));
            time_pump = delta_water_vol / speed_pump * 1000; // *1000 to get milliseconds.

            Serial.println("NEW MEASUREMENT");
            Serial.println("Interval: " + String(interval));
            Serial.println("a_slope: " + String(a_slope));
            Serial.println("b_dry_soil: " + String(b_dry_soil));
            Serial.println("dry weight: " + String(dry_weight));
            Serial.println("soil_max_wc: " + String(soil_max_wc));
            Serial.println("desired_wc: " + String(desired_wc));
            Serial.println("Sensor Value:" + String(y_soil_sensor));
            Serial.println("current_cw: " + String(x_current_wc));
            Serial.println("delta_water_vol: " + String(delta_water_vol));
            Serial.println("time_pump: " + String(time_pump/1000));

          }
        }
      };

      SoilMoist sm1(4, 8000, -2363.4, 2675.2, 100, 0.436, 0.35, 2.3); // pin = A0; interval = 1000 ms.

      void setup() {
      Serial.begin(9600);
      }

      void loop() {
        sm1.Update();
      }
                  </code></pre>
                </div>
            </div>
        </div>

    </body>

    </html>
